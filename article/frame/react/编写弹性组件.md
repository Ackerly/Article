# ç¼–å†™å¼¹æ€§ç»„ä»¶
## æ¦‚è¿°
å¼¹æ€§ç»„ä»¶çš„å››ä¸ªç‰¹å¾ï¼š
- ä¸è¦é˜»å¡æ•°æ®æµ
- æ—¶åˆ»å‡†å¤‡å¥½æ¸²æŸ“
- ä¸è¦æœ‰å•ä¾‹ç»„ä»¶
- éš”ç¦»æœ¬åœ°çŠ¶æ€

## ä¸è¦é˜»å¡æ¸²æŸ“çš„æ•°æ®æµ
ä¸é˜»å¡æ•°æ®æµçš„æ„æ€å°±æ˜¯**ä¸è¦å°†æ¥æ”¶åˆ°çš„å‚æ•°æœ¬åœ°åŒ–ï¼Œæˆ–è€…ä½¿ç”¨ç»„ä»¶å®Œå…¨å—æ§**  
Class Componentè¯­æ³•ä¸‹ï¼Œç”±äºæœ‰ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œåœ¨æŸä¸ªç”Ÿå‘½å‘¨æœŸå°†propså­˜å‚¨åˆ°stateçš„æ–¹å¼å±¡è§ä¸é²œï¼Œä¸€æ—¦å°†propså›ºåŒ–åˆ°stateï¼Œç»„ä»¶å°±ä¸å—æ§äº†ï¼š
```
class Button extends React.Component {
  state = {
    color: this.props.color
  };
  render() {
    const { color } = this.state; // ğŸ”´ `color` is stale!
    return <button className={"Button-" + color}>{this.props.children}</button>;
  }
}
```
å½“ç»„ä»¶å†æ¬¡åˆ·æ–°æ—¶ï¼Œprops.colorå˜åŒ–ï¼Œä½†state.colorä¸ä¼šå˜ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯é˜»å¡äº†æ•°æ®æµï¼Œå¦‚æœé€šè¿‡å…¶ä»–ç”Ÿå‘½å‘¨æœŸï¼ˆcomponentWillReceivePropsï¼‰æˆ–componentDidUpdateå»ä¿®å¤ï¼Œä»£ç å°†éš¾ä»¥ç®¡ç†ã€‚  
ç„¶è€ŒFunction Componentæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦å°†propså­˜å‚¨åˆ°stateï¼Œç›´æ¥æ¸²æŸ“ï¼š
``` 
function Button({ color, children }) {
  return (
    // `color` is always fresh!
    <button className={"Button-" + color}>{children}</button>
  );
}
```
å¯¹propsè¿›è¡ŒåŠ å·¥ï¼Œåˆ©ç”¨useMemoå¯¹åŠ å·¥è¿‡ç¨‹è¿›è¡Œç¼“å­˜ï¼Œä»…å½“ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°æ‰§è¡Œ
``` 
const textColor = useMemo(
  () => slowlyCalculateTextColor(color),
  [color] // âœ… Donâ€™t recalculate until `color` changes
);
```
## ä¸è¦é˜»å¡å‰¯ä½œç”¨çš„æ•°æ®æµ
å‘è¯·æ±‚å°±æ˜¯ä¸€ç§å‰¯ä½œç”¨ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç»„ä»¶å†…å‘è¯·æ±‚ï¼Œåœ¨å–æ•°å‚æ•°å˜åŒ–æ—¶ï¼Œæœ€å¥½èƒ½é‡æ–°å–æ•°
``` 
class SearchResults extends React.Component {
  state = {
    data: null
  };
  componentDidMount() {
    this.fetchResults();
  }
  componentDidUpdate(prevProps) {
    if (prevProps.query !== this.props.query) {
      // âœ… Refetch on change
      this.fetchResults();
    }
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // Do the fetching...
  }
  getFetchUrl() {
    return "http://myapi/results?query" + this.props.query; // âœ… Updates are handled
  }
  render() {
    // ...
  }
}
```
å¦‚æœClass Componentæ–¹å¼å®ç°ï¼Œéœ€è¦å°†è¯·æ±‚å‡½æ•°getFetchUrlæŠ½å‡ºæ¥ï¼Œå¹¶åœ¨componentDidMountä¸è°ƒç”¨å®ƒï¼Œè¿˜è¦æ³¨æ„componentDidUpdateæ—¶å¦‚æœå–æ•°å‚æ•°state.queryæ²¡æœ‰å˜åŒ–åˆ™ä¸æ‰§è¡ŒgetFetchUrlã€‚  
è¿™æ ·çš„ç»´æŠ¤ä½“éªŒå¾ˆç³Ÿç³•ï¼Œå¦‚æœå–æ•°å‚æ•°å¢åŠ state.currentPageï¼Œå¾ˆå¯èƒ½åœ¨componentDidUpdateä¸­æ¼æ‰å¯¹state.currentPageçš„åˆ¤æ–­ã€‚  
å¦‚æœä½¿ç”¨Function Componentï¼Œå¯ä»¥é€šè¿‡useCallbackå°†æ•´ä¸ªå–æ•°è¿‡ç¨‹ä½œä¸ºä¸€ä¸ªæ•´ä½“
``` 
function SearchResults({ query }) {
  const [data, setData] = useState(null);
  const [currentPage, setCurrentPage] = useState(0);

  const getFetchUrl = useCallback(() => {
    return "http://myapi/results?query=" + query + "&page=" + currentPage;
  }, [currentPage, query]);

  useEffect(() => {
    const url = getFetchUrl();
    // Do the fetching...
  }, [getFetchUrl]); // âœ… Refetch on change

  // ...
}
```
Function Componentå¯¹propsä¸stateçš„æ•°æ®ä¸€è§†åŒä»ï¼Œå¯ä»¥å°†å–æ•°é€»è¾‘ä¸â€œæ›´æ–°åˆ¤æ–­â€é€šè¿‡useCallbackå®Œå…¨å°è£…åœ¨ä¸€ä¸ªå‡½æ•°å†…ï¼Œå†å°†è¿™ä¸ªå‡½æ•°ä½œä¸ºæ•´ä½“ä¾èµ–é¡¹æ·»åŠ åˆ°useEffectï¼Œå¦‚æœæœªæ¥å†æ–°å¢ä¸€ä¸ªå‚æ•°ï¼Œåªä¿®æ”¹getFetchUrlè¿™ä¸ªå‡½æ•°å³å¯ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡eslint-plugin-react-hooksæ’ä»¶é™æ€åˆ†ææ˜¯å¦é—æ¼äº†ä¾èµ–é¡¹ã€‚  
Function Componentä¸ä½†å°†ä¾èµ–é¡¹èšåˆèµ·æ¥ï¼Œè¿˜è§£å†³äº†Class Componentåˆ†æ•£åœ¨å¤šå¤„ç”Ÿå‘½å‘¨æœŸçš„å‡½æ•°åˆ¤æ–­ï¼Œå¼•å‘çš„æ— æ³•é™æ€åˆ†æä¾èµ–çš„é—®é¢˜
## ä¸è¦å› ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œé˜»å¡æ•°æ®æµ
ç›¸æ¯”PureComponentä¸React.memoï¼Œæ‰‹åŠ¨è¿›è¡Œæ¯”è¾ƒåŒ–æ˜¯ä¸å¤ªå®‰å…¨çš„ï¼Œå› ä¸ºä½ å¯èƒ½ä¼šå¿˜è®°å¯¹å‡½æ•°è¿›è¡Œæ¯”å¯¹ï¼š
``` 
class Button extends React.Component {
  shouldComponentUpdate(prevProps) {
    // ğŸ”´ Doesn't compare this.props.onClick
    return this.props.color !== prevProps.color;
  }
  render() {
    const onClick = this.props.onClick; // ğŸ”´ Doesn't reflect updates
    const textColor = slowlyCalculateTextColor(this.props.color);
    return (
      <button
        onClick={onClick}
        className={"Button-" + this.props.color + " Button-text-" + textColor}
      >
        {this.props.children}
      </button>
    );
  }
}
```
ä¸Šé¢ä»£ç æ‰‹åŠ¨è¿›è¡ŒshouldComponentUpdateå¯¹æ¯”ä¼˜åŒ–ï¼Œä½†æ˜¯å¿½ç•¥äº†å¯¹å‡½æ•°å‚æ•°onClickçš„å¯¹æ¯”ï¼Œå› ä¸ºè™½ç„¶å¤§éƒ¨åˆ†æ—¶é—´onClickç¡®å®æ²¡æœ‰å˜åŒ–ï¼Œå› æ­¤ä»£ç ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆbug
``` 
class MyForm extends React.Component {
  handleClick = () => {
    // Always the same function
    // Do something
  };
  render() {
    return (
      <>
        <h1>Hello!</h1>
        <Button color="green" onClick={this.handleClick}>
          Press me
        </Button>
      </>
    );
  }
}
```
å¦ä¸€ç§æ–¹å¼å®ç°onClickéšæœºåœ¨nullå’Œthis.handleClickä¹‹é—´åˆ‡æ¢ï¼š
```
class MyForm extends React.Component {
  state = {
    isEnabled: true
  };
  handleClick = () => {
    this.setState({ isEnabled: false });
    // Do something
  };
  render() {
    return (
      <>
        <h1>Hello!</h1>
        <Button
          color="green"
          onClick={
            // ğŸ”´ Button ignores updates to the onClick prop
            this.state.isEnabled ? this.handleClick : null
          }
        >
          Press me
        </Button>
      </>
    );
  }
}
```
å¦‚æœdraft.contentå˜åŒ–äº†ï¼Œåˆ™onClickå‡½æ•°å˜åŒ–
``` 
drafts.map(draft => (
  <Button
    color="blue"
    key={draft.id}
    onClick={
      // ğŸ”´ Button ignores updates to the onClick prop
      this.handlePublish.bind(this, draft.content)
    }
  >
    Publish
  </Button>
));
```
å¦‚æœå­ç»„ä»¶è¿›è¡Œæ‰‹åŠ¨ä¼˜åŒ–æ—¶ï¼Œå¦‚æœæ¼äº†å¯¹å‡½æ•°çš„å¯¹æ¯”ï¼Œå¾ˆæœ‰å¯èƒ½æ‰§è¡Œåˆ°æ—§çš„å‡½æ•°å¯¼è‡´é”™è¯¯çš„é€»è¾‘ã€‚  
æ‰€ä»¥å°½é‡ä¸è¦è‡ªå·±è¿›è¡Œä¼˜åŒ–ï¼ŒåŒæ—¶åœ¨Function Componentç¯å¢ƒä¸‹ï¼Œåœ¨å†…éƒ¨ç”³æ˜çš„å‡½æ•°æ¯æ¬¡éƒ½æœ‰ä¸åŒçš„å¼•ç”¨ï¼Œå› æ­¤ä¾¿äºå‘ç°é€»è¾‘BUGï¼ŒåŒæ—¶åˆ©ç”¨useCallbackä¸useContextæœ‰åŠ©è§£å†³è¿™ä¸ªé—®é¢˜
## æ—¶åˆ»æ¢å‘—æ¸²æŸ“
ç¡®ä¿ä½ çš„ç»„ä»¶å¯ä»¥éšæ—¶æ¸²æŸ“ï¼Œä¸”ä¸ä¼šå¯¼è‡´å†…éƒ¨çŠ¶æ€ç®¡ç†å‡ºç°BUGã€‚  
åšåˆ°è¿™ä¸€ç‚¹ä¸å®¹æ˜“ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤æ‚ç»„ä»¶è‹¥æœæ¥å—ä¸€ä¸ªçŠ¶æ€ä½œä¸ºèµ·ç‚¹ï¼Œä¹‹åçš„ä»£ç åŸºäºè¿™ä¸ªèµ·ç‚¹æ´¾ç”Ÿäº†è®¸å¤šå†…éƒ¨çŠ¶æ€ï¼ŒæŸä¸ªæ—¶åˆ»æ”¹å˜äº†è¿™ä¸ªèµ·å§‹å€¼ï¼Œç»„ä»¶è¿˜èƒ½æ­£å¸¸è¿è¡Œå—ï¼Ÿ  
æ¯”å¦‚ï¼š
``` 
class TextInput extends React.PureComponent {
  state = {
    value: ""
  };
  // ğŸ”´ Resets local state on every parent render
  componentWillReceiveProps(nextProps) {
    this.setState({ value: nextProps.value });
  }
  handleChange = e => {
    this.setState({ value: e.target.value });
  };
  render() {
    return <input value={this.state.value} onChange={this.handleChange} />;
  }
}
```
componentWillReceivePropsæ ‡è¯†æ¯æ¬¡ç»„ä»¶æ¥å—åˆ°æ–°çš„propsï¼Œéƒ½å°†props.valueåŒæ­¥åˆ°state.valueã€‚è¿™å°±æ˜¯ä¸€ç§æ´¾ç”Ÿstateï¼Œè™½ç„¶çœ‹ä¸Šå»å¯ä»¥åšåˆ°ä¼˜é›…æ‰¿æ¥propsçš„å˜åŒ–ï¼Œä½†çˆ¶å…ƒç´ å› ä¸ºå…¶ä»–åŸå› renderä¼šå¯¼è‡´stateã€‚valueéæ­£å¸¸é‡ç½®ã€‚æ¯”å¦‚çˆ¶å…ƒç´ çš„forceUpdateã€‚  
å½“ç„¶å¯ä»¥é€šè¿‡ä¸è¦é˜»å¡æ¸²æŸ“çš„æ•°æ®æµä¸€èŠ‚æ‰€è¯´çš„æ–¹å¼ï¼Œæ¯”å¦‚PureComponentï¼ŒshouldComponentUpdateï¼ŒReact.memoæ¥åšæ€§èƒ½ä¼˜åŒ–ï¼ˆå½“props.valueæ²¡æœ‰å˜åŒ–æ—¶å°±ä¸ä¼šé‡ç½®state.valueï¼‰,ä½†è¿™æ ·ä»£ç ä¾ç„¶æ˜¯è„†å¼±çš„ã€‚  
å¥å£®çš„diamanteä¸ä¼šå› ä¸ºåˆ é™¤æŸé¡¹ä¼˜åŒ–å°±å‡ºç°BUGï¼Œä¸è¦ä½¿ç”¨æ´¾ç”Ÿstateå°±èƒ½é¿å…æ­¤é—®é¢˜
å¦‚æœåšæˆéå—æ§ç»„ä»¶ï¼Œå´æƒ³é‡ç½®åˆå§‹å€¼ï¼Œåœ¨çˆ¶çº§è°ƒç”¨å‡ºåŠ ä¸Škeyæ¥è§£å†³ï¼š
``` 
<EmailInput defaultEmail={this.props.user.email} key={this.props.user.id} />
```
å¯ä»¥é€šè¿‡refè§£å†³ï¼Œè®©å­å…ƒç´ æä¾›ä¸€ä¸ªresetå‡½æ•°ï¼Œä¸è¿‡ä¸æ¨èä½¿ç”¨ref
## ä¸è¦æœ‰å•ä¾‹ç»„ä»¶
ä¸€ä¸ªå¼¹æ€§ç»„ä»¶çš„åº”ç”¨åº”è¯¥èƒ½é€šè¿‡ä¸‹é¢è€ƒéªŒ
``` 
ReactDOM.render(
  <>
    <MyApp />
    <MyApp />
  </>,
  document.getElementById("root")
);
```
æ•´ä¸ªåº”ç”¨æ¸²æŸ“ä¸¤éæ˜¯å¦èƒ½å„è‡ªæ­£ç¡®è¿ä½œï¼Ÿ
é™¤äº†ç»„ä»¶æœ¬åœ°çŠ¶æ€ç”±æœ¬åœ°ç»´æŠ¤å¤–ï¼Œå…·æœ‰å¼¹æ€§çš„ç»„ä»¶ä¸åº”è¯¥å› ä¸ºå…¶ä»–å®ä¾‹è°ƒç”¨æŸäº›å‡½æ•°è€Œ**â€œæ°¸è¿œé”™è¿‡äº†æŸäº›çŠ¶æ€æˆ–åŠŸèƒ½â€**  
é‚£ä¹ˆå½“å¦ä¸€ä¸ªç»„ä»¶è¿›è¡Œé”€æ¯æ“ä½œæ—¶å¯èƒ½ä¼šç ´ä¼šç ´åè¿™ä¸ªå®ä¾‹çš„ä¸­é—´çŠ¶æ€ï¼Œä¸€ä¸ªå…·æœ‰å¼¹æ€§çš„ç»„ä»¶åº”è¯¥èƒ½éšæ—¶å“åº”çŠ¶æ€çš„å˜åŒ–ï¼Œæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µçš„Function Componentå¤„ç†èµ·æ¥æ˜¾ç„¶æ›´å¾—å¿ƒåº”æ‰‹  
ä¸€ä¸ªå±é™©çš„ç»„ä»¶ä¸ä¼šæ€è€ƒï¼šæ²¡æœ‰äººéšæ„ç ´åæ•°æ®æµï¼Œåªè¦åœ¨didMountä¸unMountæ—¶åšå¥½æ•°æ®åˆå§‹åŒ–å’Œé”€æ¯å°±è¡Œäº†ã€‚  
## éš”ç¦»æœ¬åœ°çŠ¶æ€
**å¾ˆå¤šæ—¶å€™éš¾ä»¥åˆ¤æ–­æ•°æ®å±äºç»„ä»¶çš„æœ¬åœ°çŠ¶æ€è¿˜æ˜¯å…¨å±€çŠ¶æ€**
**åˆ¤æ–­æ–¹æ³•ï¼šç»„ä»¶åŒæ—¶æ¸²æŸ“ä¸¤ä¸ªå®ä¾‹ï¼Œæ•°æ®ä¼šåŒæ—¶å½±å“è¿™ä¸¤ä¸ªå®ä¾‹å—ï¼Œå¦‚æœä¸ä¼šå°±é€‚åˆä½œä¸ºæœ¬åœ°çŠ¶æ€*
**ä¸Šå±‚ä¸šåŠ¡åˆ°åº•å±‚ä¸šåŠ¡é€šç”¨ç»„ä»¶ä¹‹é—´æœ¬åœ°çŠ¶æ€æ•°é‡æ˜¯é€’å¢çš„**
``` 
ä¸šåŠ¡
    -> å…¨å±€æ•°æ®æµ
        -> é¡µé¢ï¼ˆå®Œå…¨ä¾èµ–å…¨å±€æ•°æ®æµï¼Œå‡ ä¹æ²¡æœ‰è‡ªå·±çš„çŠ¶æ€ï¼‰
            -> ä¸šåŠ¡ç»„ä»¶ï¼ˆä»é¡µé¢æˆ–å…¨å±€æ•°æ®æµç»§æ‰¿æ•°æ®ï¼Œå¾ˆå°‘æœ‰è‡ªå·±çŠ¶æ€ï¼‰
                -> é€šç”¨ç»„ä»¶ï¼ˆå®Œå…¨å—æ§ï¼Œæ¯”å¦‚inputï¼Œæˆ–å¤§é‡å†…èšçŠ¶æ€çš„å¤æ‚é€šç”¨é€»è¾‘ï¼Œæ¯”å¦‚monaco-editorï¼‰
```
## é¢‘ç¹ä¼ é€’å›è°ƒå‡½æ•°
Function Componentä¼šå¯¼è‡´ç»„ä»¶ç²’åº¦æ‹†åˆ†çš„æ¯”è¾ƒç»†ï¼Œåœ¨æé«˜å¯ç»´æŠ¤æ€§çš„åŒæ—¶ä¹Ÿä¼šå¯¼è‡´å…¨å±€stateæˆä¸ºè¿‡å»å¼ï¼Œå¦‚ï¼š
``` 
const App = memo(function App() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState("nick");

  return (
    <>
      <Count count={count} setCount={setCount}/>
      <Name name={name} setName={setName}/>
    </>
  );
});

const Count = memo(function Count(props) {
  return (
      <input value={props.count} onChange={pipeEvent(props.setCount)}>
  );
});

const Name = memo(function Name(props) {
  return (
  <input value={props.name} onChange={pipeEvent(props.setName)}>
  );
});
```
è™½ç„¶å°†å­ç»„ä»¶Countä¸Nameæ‹†åˆ†å‡ºæ¥ï¼Œé€»è¾‘æ›´åŠ è§£è€¦ï¼Œåœ¨å­ç»„ä»¶éœ€è¦æ›´æ–°çˆ¶ç»„ä»¶çš„çŠ¶æ€å°±å˜å¾—éº»çƒ¦ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›å°†å‡½æ•°ä½œä¸ºå‚æ•°é€ä¼ ç»™å­ç»„ä»¶ã€‚  
ä¸€ç§åŠæ³•æ˜¯å°†å‡½æ•°é€šè¿‡Contextä¼ ç»™å­ç»„ä»¶
``` 
const SetCount = createContext(null)
const SetName = createContext(null)

const App = memo(function App() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState("nick");

  return (
    <SetCount.Provider value={setCount}>
      <SetName.Provider value={setName}>
        <Count count={count}/>
        <Name name={name}/>
      </SetName.Provider>
    </SetCount.Provider>
  );
});

const Count = memo(function Count(props) {
  const setCount = useContext(SetCount)
  return (
      <input value={props.count} onChange={pipeEvent(setCount)}>
  );
});

const Name = memo(function Name(props) {
  const setName = useContext(SetName)
  return (
  <input value={props.name} onChange={pipeEvent(setName)}>
  );
});
```
ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´Providerè¿‡äºè‡ƒè‚¿ï¼Œå› æ­¤å»ºè®®éƒ¨åˆ†ç»„ä»¶ä½¿ç”¨useReduceræ›¿ä»£useStateï¼Œå°†å‡½æ•°åˆå¹¶åˆ°dispatchï¼š
``` 
const AppDispatch = createContext(null)

class State = {
  count = 0
  name = 'nick'
}

function appReducer(state, action) {
  switch(action.type) {
    case 'setCount':
      return {
        ...state,
        count: action.value
      }
    case 'setName':
      return {
        ...state,
        name: action.value
      }
    default:
      return state
  }
}

const App = memo(function App() {
  const [state, dispatch] = useReducer(appReducer, new State())

  return (
    <AppDispatch.Provider value={dispatch}>
      <Count count={count}/>
      <Name name={name}/>
    </AppDispatch.Provider>
  );
});

const Count = memo(function Count(props) {
  const dispatch = useContext(AppDispatch)
  return (
      <input value={props.count} onChange={pipeEvent(value => dispatch({type: 'setCount', value}))}>
  );
});

const Name = memo(function Name(props) {
  const dispatch = useContext(AppDispatch)
  return (
  <input value={props.name} onChange={pipeEvent(pipeEvent(value => dispatch({type: 'setName', value})))}>
  );
});
```
å¾…çŠ¶æ€èšåˆåˆ°reducerä¸­ï¼Œè¿™æ ·ä¸€ä¸ªContextProviderå°±èƒ½è§£å†³æ‰€æœ‰æ•°æ®å¤„ç†é—®é¢˜äº†ã€‚  

## useCallbackå‚æ•°å˜åŒ–é¢‘ç¹
useCallbackåˆ›å»ºä¸€ä¸ªImmutableçš„å‡½æ•°ï¼š
```` 
function Form() {
  const [text, updateText] = useState("");

  const handleSubmit = useCallback(() => {
    const currentText = text;
    alert(currentText);
  }, [text]);

  return (
    <>
      <input value={text} onChange={e => updateText(e.target.value)} />
      <ExpensiveTree onSubmit={handleSubmit} />
    </>
  );
}
````
ä½†æ˜¯å‡½æ•°ä¾èµ–[text]å˜åŒ–è¿‡äºé¢‘ç¹ï¼Œä»¥è‡´åœ¨æ¯ä¸ªrenderéƒ½ä¼šé‡æ–°ç”ŸæˆhandleSubmitå‡½æ•°ï¼Œå¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“ã€‚å¯ä»¥åˆ©ç”¨Refè§„é¿è¿™ä¸ªé—®é¢˜ï¼š
``` 
function Form() {
  const [text, updateText] = useState("");
  const textRef = useRef();

  useEffect(() => {
    textRef.current = text; // Write it to the ref
  });

  const handleSubmit = useCallback(() => {
    const currentText = textRef.current; // Read it from the ref
    alert(currentText);
  }, [textRef]); // Don't recreate handleSubmit like [text] would do

  return (
    <>
      <input value={text} onChange={e => updateText(e.target.value)} />
      <ExpensiveTree onSubmit={handleSubmit} />
    </>
  );
}
```
å¦å¤–ä¸€ç§å°†è¿™ä¸ªè¿‡ç¨‹å°è£…ä¸ºè‡ªå®šä¹‰Hooksï¼š
``` 
function Form() {
  const [text, updateText] = useState("");
  // Will be memoized even if `text` changes:
  const handleSubmit = useEventCallback(() => {
    alert(text);
  }, [text]);

  return (
    <>
      <input value={text} onChange={e => updateText(e.target.value)} />
      <ExpensiveTree onSubmit={handleSubmit} />
    </>
  );
}

function useEventCallback(fn, dependencies) {
  const ref = useRef(() => {
    throw new Error("Cannot call an event handler while rendering.");
  });

  useEffect(() => {
    ref.current = fn;
  }, [fn, ...dependencies]);

  return useCallback(() => {
    const fn = ref.current;
    return fn();
  }, [ref]);
}
```
## å¯èƒ½è¢«æ»¥ç”¨çš„useReducer
åˆ©ç”¨useReducerè§£å†³â€œå‡½æ•°åŒæ—¶ä¾èµ–å¤šä¸ªå¤–éƒ¨å˜é‡çš„é—®é¢˜â€ï¼Œå¦‚ï¼š
``` 
const reducer = (state, action) => {
  switch (action.type) {
    case "increment":
      return { value: state.value + 1 };
    case "decrement":
      return { value: state.value - 1 };
    case "incrementAmount":
      return { value: state.value + action.amount };
    default:
      throw new Error();
  }
};

const [state, dispatch] = useReducer(reducer, { value: 0 });
```
useRedcerå¯¹stateä¸actionçš„å®šä¹‰å¯ä»¥å¾ˆéšæ„ï¼Œå¯ä»¥åˆ©ç”¨useReduceræ‰“é€ useStateã€‚  
æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºæ‹¥æœ‰å¤æ•°keyçš„useState
``` 
const [state, setState] = useState({ count: 0, name: "nick" });

// ä¿®æ”¹ count
setState(state => ({ ...state, count: 1 }));

// ä¿®æ”¹ name
setState(state => ({ ...state, name: "jack" }));
```
åˆ©ç”¨useReducerå®ç°ç›¸ä¼¼åŠŸèƒ½
``` 
function reducer(state, action) {
  return action(state);
}

const [state, dispatch] = useReducer(reducer, { count: 0, name: "nick" });

// ä¿®æ”¹ count
dispatch(state => ({ ...state, count: 1 }));

// ä¿®æ”¹ name
dispatch(state => ({ ...state, name: "jack" }));
```
å› æ­¤é’ˆå¯¹å¦‚ä¸Šæƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½æ»¥ç”¨äº†useReducerï¼Œå»ºè®®ç›´æ¥ç”¨useStateä»£æ›¿


å‚è€ƒï¼š
[ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶](https://github.com/ascoders/weekly/blob/master/%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/97.%E7%B2%BE%E8%AF%BB%E3%80%8A%E7%BC%96%E5%86%99%E6%9C%89%E5%BC%B9%E6%80%A7%E7%9A%84%E7%BB%84%E4%BB%B6%E3%80%8B.md)
