# 前端埋点质量量化与优化
## 埋点简介
埋点是用来分析用户使用应用行为过程的最常用的数据采集方案，埋点数据的特征是大数据和连贯性。  
大数据表现为埋点信息量大和埋点数量多。埋点信息量大是指单个埋点就包含了用户（Who）、时间（When）、位置（Where）、行为（How）、设备、应用及事件（What）等信息。埋点数量多是指不同的埋点会分为不同的事件类型比如应用的启动、页面的浏览、按钮的点击、内容的展现等，单个用户一次使用应用的期间就可能触发几十上百个埋点事件，千万日活的应用每天埋点上报总量就至少是百亿以上的量级。  
连贯性表现为对行为过程的描述是连贯的，以单个设备产生的埋点 id 按照埋点客户端时间戳排序，能够清晰的看数该设备的一系列行为，以电商类的应用为例，连贯性的行为可能是应用启动、商品列表展示、点击搜索、搜索结果展示、某个商品卡片展示、点击商品卡片、商品详情展示、加入购物车按钮点击等等。通过这样的连贯的行为就可以分析【加入购物车】这个动作发生的原因可能是【搜索】到了感兴趣的商品。正是基于埋点的连贯性为应用的行为分析、归因分析等提供了依据。  

## 埋点质量
埋点的质量简单讲就是看埋点数据是否准确，基于前边提到的埋点数据特征，将埋点质量或者准确性也分为两个方面，一是埋点采集上报的数量是否准确，二是埋点上报的信息是否准确。本篇文章是站在前端角度，主要讲第一个方面采集上报方面的质量问题，第二个方面只做简要描述。  
要衡量埋点的质量，就需要一个可量化的指标，对于埋点采集上报数量业界常用的指标是埋点丢失率。  

**埋点丢失率**  
埋点丢失率是指从埋点采集到上报再到最终落库后埋点丢失数量的比率，计算公式非常简单简单：埋点丢失的数量 / 埋点应上报的总数。  

**丢失率统计方案**  
丢失率的计算公式比较简单，问题是如何统计丢失的数量。造成埋点丢失的原因也比较多，比如前端进程杀死或崩溃时埋点采集了但没上报，网络问题埋点发送不出去或者发送过程中丢失等等，这些单靠服务端是无法进行完全统计的，因此方案依赖前端的实现。  
以Web 前端为例，每个浏览器设备是独立的，需要以单个设备为维度进行埋点丢失的统计。  
接下来是其中的 device_id 和埋点丢失的数量的统计，这就需要在埋点上报时携带设备唯一标识（device_id）和用于标记是第几条埋点的自增 id。  
其中设备 id 比较容易理解，首次可以随机生成一个 uuid 存储到浏览器的本地存储中，如果考虑到有多个顶级域名相同的子产品，比如 www.kuaishou.com 和 live.kuaishou.com 需要共享设备 id 可以存储到 cookie 中，否则也可以设置到 localStorage 中。  




参考:  
[前端埋点质量量化与优化](https://mp.weixin.qq.com/s/DRqXD92biblFjcyXlvgwHg)
