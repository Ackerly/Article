# 由Babel理解前端编译原理
编译型语言是在代码运行前编译器将编程语言转换成机器语言，运行时不需要重新翻译，直接使用编译的结果就行了。而解释型语言也是需要将编程语言转换成机器语言，但是是在运行时转换的。  
通常我们都将 JavaScript 归类为「解释型语言」，以至于很多人都误以为前端代码是不需要编译的，但其实 JavaScript 引擎进行编译的步骤和传统的编译语言非常相似，只不过与传统的编译语言不同，它不是提前编译的。并且随着现代浏览器和前端领域的蓬勃发展，编译器在前端领域的应用越来越广泛，就日常工作而言，包括但不限于以下几个方面：  
- v8 引擎、typescript 编译器（tsc）
- webpack loader 编译器，babel、SWC 等编译工具。
- angular、Vue 等框架的模板编译器、jsx

**概述**  
编译本质上是一种转换技术，从一门编程语言转换成另一门编程语言，或者从高级语言转换成低级语言，或者从高级语言到高级语言，所谓的高级语言和低级语言主要是指下面的区分：  
- 高级语言：有很多用于描述逻辑的语言特性，比如分支、循环、函数、面向对象等，接近人的思维，可以让开发者快速的通过它来表达各种逻辑。比如 c++、javascript。
- 低级语言：与硬件和执行细节有关，会操作寄存器、内存，具体做内存与寄存器之间的复制，需要开发者理解熟悉计算机的工作原理，熟悉具体的执行细节。比如汇编语言、机器语言

约定的编译规则，就是指各种编程语言的语法规则，不同的编译器会产出不同的“编译结果”，例如 C/C++ 语言经过编译得到二进制的机器码，然后交给操作系统，例如当我们运行 tsc 命令就会将 TS 代码编译为 js 代码，再比如执行 babel 命令会将 es6+ 的代码编译为指定目标(es5)的 js 代码。  
整个编译过程主要分为两个阶段：编译 前端和编译后端  
编译前端主要就是帮助计算机阅读源代码并理解源代码的结构、含义、作用等，将源代码由一串无意义的字符流解析为一个个的有特定含义的构件。通常情况下，编译前端会产生一种用于给编译后端消费的中间产物，比如我们常见的抽象语法树 AST，而编译后端则是在前端解析的结果和基础上，进一步优化和转换并生成最终的目标代码。  

**上下文无关文法**  
前面提到编译器会根据「约定的编译规则」进行编译，这里「约定的编译规则」就是指「上下文无关文法（CFG）。CFG 用于在理论上的形式化定义一门语言的语法，或者说，用于系统地描述程序设计语言的构造（比如表达式和语句）  
几乎所有程序设计语言都是通过上下文无关文法来定义的，与正则表达式比较像，但是比正则表达式功能更强大，它能表达非常复杂的文法，比如 C 语言语法用正则表达式来表示不可能做到，但是可以用 CFG 的一组规则来表达。  
要理解上下文无关文法，需要先理解下面几个概念：  
- 终结符：可以理解为基础符号，词法符号，是不可替代的，是固定存在的，不能通过文法规则生成的
- 非终结符：句法变量，是可以替代的
- 产生式规则：语法是由终结符集、非终结符集和产生式规则共同组成。产生式规则定义了符号之间如何转换替代。规则的左侧是规则头，即非终结符，是可以被替代的符号；右侧是产生式，是具体的内容

 a, b, c, d 为终结符（用小写表示），(S, A) 为非终结符（用大写表示）。S -> cAd， A -> a | ab 表示产生式规则。S->cAd，然后可以产生"cad"，“cabd” 等符合文法的内容  
```
S -> cAd
A -> a | ab
```
如何用 CFG 来定义一门语言的语法?我们假设一个极其简单的语言，这个语言只能像 js 那样声明整数型常量，以及声明不接受任何参数且只能直接返回常量加法的箭头函数。
```
const a = 10
const b = 20
const c = () =>  a + b
```
这个语言的文法表达如下：  
```
program :: statement+
statement :: declare | func
declare :: CONST VARIABLE ASSIGN INTEGER
func :: CONST LPAREN RPAREN ARROW expression
expression :: VARIABLE + VARIABLE


CONST  :: "const"
ASSIGN :: "="
LPAREN :: "("
RPAREN :: ")"
ARROW  :: "=>"
INTEGER :: \d+
VARIABLE :: \w[\w\d$_]*
```
整个文法的表达，涵盖了很多正则表达式的概念。该表达是一种自顶向下的规范：  
1. 首先入口约束了程序（program）是由一条（及以上）的表达式（statement）构成，
2. 而表达式又可以由声明语句（declare）或函数语句（func）构成。
3. 声明语句依次由 const、关键字、符号 =、整数 从左到右排列构成。
4. 整数的定义则直接使用正则表达式来约束。函数语句也是类似。


参考:
[由Babel理解前端编译原理](https://mp.weixin.qq.com/s/uaJD35x0Lw4ft4wtMaB9Ow)