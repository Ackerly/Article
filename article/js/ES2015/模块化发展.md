# 详解模块化
## 模块化的发展
- 直接定义依赖（1996）  
通过全局方法定义，应用模块，与现在的CommonJS相似，区别是CommonJS以文件为模块，这种方法可以在任何文件中定义模块，模块不与文件关联。
- 闭包模块化模式（2003）  
解决全局变量污染问题，闭包返回模块对象，只需对外暴露一个全局变量
- 模板依赖定义（2006）  
通过后端语法聚合js文件，从而实现依赖加载
- 注释依赖定义（2006）  
和模板依赖同时不限，与1999方案不同的，不仅仅是模块定义方式，而是终于以文件为单位定义模块，通过lazyjs加载文件，名同事读取文件注释，继续递归加载剩下的文件
- 外部依赖定义（2007）
将依赖抽出单文件定义，这种方式不利于项目管理，毕竟依赖抽到代码之外，所以才有通过webpack打包为一个文件的方式暴力替换为CommonJS方式出现
- Sandbox模式（2009）  
将所有模块塞到一个sandbox变量中，硬伤无法解决命名冲突问题，并且Sandbox需要定义在全局，存在覆盖的风险。模块化需要保证全局变量尽量干净。
- 依赖注入（2009）    
angular，react、vue等流行框架中，但依赖注入和解决模块化问题还差的远
- CommonJS（2009）  
真正解决模块化问题，从node端逐渐发力到前端，需要使用构建工具模拟
- Amd（2009）  
同一时期的产物，主要解决前端冬天加载依赖，比CommonJS体积更小，按需加载
- Umd（2011）  
兼容CommonJS和Amd，核心思想在CommonJS环境，函数执行结果交给module。exports实现CommonJS，否则用Amd的环境define
- Labeled Modules（2012）  
和CommonJS很像，碰上CommonJS和Amd，被人遗忘
- YModules（2013）  
使用provide取代return，可以控制模块结束时机，处理异步结果；拿到第二个参数module，修改其他模块的定义
- ES2015 Modules（2015）  
没有被浏览器实现，大部分项目通过babel或typescript提前体验

## 从语言层面到文件层面的模块化
从CommonJS之前只是封装，没有一套模块化规范，就像类和包的概念， 
前端模块化方案成型比较晚，可能早期应用的复杂在后端，前端相对比较简单，在ajax火了之后，web app开始流行，前端复杂度呈指数级上涨，到今天几乎和后端接近一个量级

## 模块化的展望
**解决html与css模块化是以后的方向**  
js的模块化不等于前端工程的模块化，Web界面由HTML、CSS和JS语言实现，不论CommonJS还是AMD包括之后的方案无法解决CSS与HTML模块化的问题  
HTML、CSS和JS合并模块化的方案，其中react/css-modules和vue都为人熟知。但是非常依赖webpack等构建工具  
对于CSS模块化，不依赖编译的方式是styled-component，通过js动态创建class。目前css也引入与js通信的机制与原生变量支持。未来css模块可能是运行时。  
对于html模块化，chrome小组调研html Modules，如果html得到浏览器，编辑器的模块化支持，未来可能会取代jsx称为最强大的模块化、模板语言  
对于js模块化，出现<script type="module">,虽然没有得到浏览器，但可能是未来的趋势，连webpack拆包都不需要，直接把源代码传到服务器，配合http2.0完美抛开预编译的枷锁  
不依赖预编译，分别实现html，css，js模块化，就是未来
## Http2.0对js模块化的推动
HTTP/2流行起来，请求和响应可以并行一次连接允许多个请求，前端就不必再开发和上线时做编译这个动作。等Import和Export被主流浏览器支持，那时候才是彻底的模块化
## Http2.0后不需要构建工具了吗
webpack新插件AggressiveSplittingPlugin充分利用HTTP/2的文件缓存能力，将业务代码自动拆分成若干个数十KB的小文件，后续任意一个文件发生变化，可以保证其他的小chunk不需要重新下载。**即使新技术出现，也需要配套的工具将前端工程问题解决方案推向极致**
## 模块化就具有最好的维护行吗
JS模块化支持日益上升的复杂度，但绝对不是唯一的解决方案，模块化之后还有有一个模块间耦合的问题，如果模块间耦合度大也会降低代码的可重用性或复用性。所以出现降低耦合的观察者模式或者发布/订阅者模式。响应式编程核心概念就是observable，就是Rx中的流，可以被subscribe，就是观察者设计模式。

原文:  
[精读模块化发展](https://github.com/ascoders/weekly/blob/master/%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/1.%E7%B2%BE%E8%AF%BB%E3%80%8Ajs%20%E6%A8%A1%E5%9D%97%E5%8C%96%E5%8F%91%E5%B1%95%E3%80%8B.md)
