# 共置
我们都想拥有易于维护的代码库，因此我们开始好心好意地使我们的代码库（或代码库中属于我们的角落）可维护且易于理解。随着时间的推移，随着代码库的增长，管理依赖项（JS、CSS、图像等）可能变得越来越困难。随着项目的增长，越来越多的代码变成“部落知识”（只有你或其他几个人知道的知识），而这种知识又导致“技术债务”。  
保持我的代码库易于管理，不仅对我（编写它的人），还有我的队友、未来的维护者以及 6 个月后的我自己。应该在我们的代码库中去为之努力。有很多不同的工具和技术可供我们使用来做到这一点。  
**让我们谈谈代码注释**  
假如我们把那些注释放在一个完全独立的文件中。一个巨大的 DOCUMENTATION.md 文件，或者甚至一个跟 src/ 目录映射对应的 docs/ 目录。听上去有意思吗？对吧，我也觉得没意思。不将我们的注释与它解释的代码共置，会让我们遇到一些严重的问题。  
- 可维护性: 会更快地失去同步或过时（比现在还快）。我们会移动或删除 src/ 里的文件而不更新相应的 docs/ 文件。
- 适用性: 在 src/ 中查看代码的人可能会错过 docs/ 中的重要注释，或者他们会不注释他们自己的代码，因为他们没有意识到他们编辑的 src/ 文件有一个对应的 docs/ 文件存在。
- 易用性: 在这种设置下，从一个位置到下一个位置的上下文切换也将是一种挑战。不得不处理多个文件的位置可能难以确保你拥有维护一个组件所需要的所有东西。
**HTML/视图**
以 HTML 为例。共置在注释中的所有好处也体现在我们的模板中。在像 React 这样的现代框架之前，视图逻辑和视图模板位于完全不同的目录中。这成为上述问题的牺牲品。如今，更常见的做法是将这些东西放在同一个文件中，例如通过 React 和 Vue。在 Angular 中，如果它不在同一个文件中，模板文件至少是紧邻与之关联的 JS 文件的。
**测试**  
这种文件共置的概念也适用于单元测试。代码库有一个 src/ 目录又有一个满是单元测试的 test/ 目录试图镜像 src/ 目录是不是很常见？所有上面描述的隐患也适用于此。  
为了帮助实现更易于维护的代码库，应该将我们的测试文件与他们正在测试的文件/文件们共置。这确保了当新的人们（或 6 个月后的我）来到代码面前，可以立即看到该模块已经过测试，并可以使用这些测试作为参考来了解这个模块。当进行变更时，它会提醒他们更新（添加/删除/修改）测试来解释它们的变更。
**状态**  
应用/组件状态感受到相同的好处。你的状态越是疏远使用它的 UI，它就越难维护。状态本地化的收益不止于可维护性，它还可以提高应用程序的性能。应用组件树中一个角落的状态变化比树顶的状态变化引起的重渲染要少得多。本地化你的状态。  
**“可复用的”工具文件**  
这也适用于“工具”文件和函数。想象你正在写一个组件并看到一些代码可以提取成自己的函数。你把它提取出来，想道：“嗯…肯定很多人都可以使用它。”所以你把它拉出来放到你应用的 utils/ 目录中然后继续你的生活。    
后来，你的组件被删除了，但是你写的工具函数却没人看见，没人想起，被留在那里了（连同它的测试一起），因为删除它的人假设它被更多地方使用到了。多年来，工程师们努力确保函数及其测试运行正常，却完全没有意识到它根本不再需要了。浪费精力和认知负荷。  

**原则**  
共置的概念可以归结为这个基本原则：  
> 将代码放置在尽可能靠近它所相关的地方

**开源变得（更）容易**  
以这种方式构筑你的项目还有其他好处。把一个组件转换为开源项目往往只需要将文件夹复制/粘贴到另一个项目并将其发布到 npm。然后你只需将它安装在你的项目中并更新你的 require/import 语句就可以了。  
例外:  
也有很好的论证关于跨越整个系统/部分系统的文档以及事物如何集成在一起。还有，你把跨组件的集成测试或端到端测试放在哪里？你可能认为那些是例外，但它们实际上也可以很好地订阅上面提到的原则。  
如果我的应用程序的一部分与用户身份验证相关并且我想为该流程写文档，我可以将 README.md 文件放在包含所有与用户身份验证相关的模块的文件夹中。如果我需要编写集成测试该流程，我可以将这些测试的文件也放在这个文件夹中。  
对于端到端测试，它们通常放在项目根部更说得通。它们超越了项目本身并进入了系统的其他部分，所以对我来说，将它们放在一个单独的目录中是说得通的。它们其实并不映射到 src/ 中的文件上。事实上，E2E 测试其实完全不关心 src/ 是如何组织的。重构和移动 src/ 目录中的文件根本不应该需要变更 E2E 测试。
参考:
[第2587期】共置](https://mp.weixin.qq.com/s/FaG96OR5K5HFXhMO5QHVmQ)
