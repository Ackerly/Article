# 以前端架构师身份，从零开始搞事
## 背景
前端工程相关问题：
1. 所有后端接口都是跨域访问的，一方面后端是开跨域的，另一方面，当访问到后端接口，前端用的路径是绝对路径；
2. 有四个环境（开发/测试/预生产/生产），打包到不同环境需要执行四个不同的命令（记不记第一条例，绝对路径的接口url），也就是说打四种包；
3. 没有自动化部署（即 CI/CD），需要手动打包，然后复制代码，通过 ftp 上传到不同服务器。所以很容易误操作；
## 解决遗留问题
1 思路  
原则：
- 确保现有稳定
- 做低成本高产出的事
- 考虑长期成本尽可能低

结合以上情况：  
1. 最重要的是人的因素；
2. 其次是判断问题的轻重缓急，逐个解决；
3. 最后是在日常搭建优化前端技术体系，尽量通过工具和规范来提高大家代码质量。

**轻重缓急分析**  

问题 | 严重 | 修复成本
---|---|---
接口变更 | 高，严重影响进度 | 低，只要和后端协调好即可
缺少CI/CD | 中 | 低，需要写个脚本自动从 gitlab 同步代码
脚手架质量低 | 中 | 中，对旧项目影响大
接口跨域 | 高 | 已有代码中，新工程低
组员代码不规范 | 高 | 高，需要时间

**明确架构师任务**  
前端架构师进行前端技术建设的核心目的，是为了提高开发效率，保证开发质量，为保障项目高质量按时交付。同时兼顾考虑中长期研发实际情况，结合团队实际能力，为未来做技术储备，为业务发展提供更多的可能性。  
任务分为三类：  
1. 基础架构设计：主要目的是从架构层面出发，通过流程化设计，规避常见问题，提高开发效率；
2. 工程化设计：与代码强相关，主要目的是提高代码质量，增强代码的长期可维护性，降低开发时间和成本；
3. 团队管理类：通过合理有效的团队管理，提高团队人效比，为未来项目研发、技术发展，进行人才储备、技术研发；

## 基础架构设计
### 前端pipeline
基础架构的核心设计，是流程设计。好的流程可以高效率低成本的运行，同时可以通过流程化规避大量问题。  
开发人员只对个人代码拥有可控权，而无法直接影响改变主分支代码，当需要提交到主分支时，需要发起 merge 请求，并经过管理员 review 代码后，将其代码合并到主分支。  
主分支代码又和线上代码进行隔离，由管理员将指定版本代码发布到指定环境。无论是哪个dev、qa 还是 pro，都将直接从 gitlab 上拉取指定提交，然后打包发布。
通过这种二次隔离，导致代码环境可控、干净、稳定。因此，无论在哪个环境，代码的发布都是幂等的，换句话说，是稳定可控可预期的。  
通过以上流程，前端代码能被保证以高质量高稳定性的状态，运行在服务器端。  
###  代码版本控制
 

参考：
[以前端架构师身份，从零开始搞事搞事搞事（1）](https://juejin.cn/post/6952066955868110879)
